import{ad as ee,ae,x as u,ai as W,aq as z,ak as o,az as le,c as a,J as P,ar as c,aX as g,b5 as te,aw as E,W as oe,av as se,ap as s,aW as re,at as ne,aQ as ue,au as ie,aR as de,aH as me,as as pe,ax as ce,ay as ve,an as ge}from"./index-e30a2666.js";import{c as be,b,e as fe,a as Ve,f as ye,h as he}from"./index.esm-195823e1.js";import{u as ke,a as i,V as _e}from"./vee-validate.esm-b2a6c747.js";import{V as xe}from"./VContainer-f01c952a.js";import{V as r}from"./VCol-ee16e47c.js";import{V as we,a as T,b as Ce}from"./VDataTableServer-7e05485a.js";import{V as L}from"./VRow-15ec713d.js";import"./VList-1061f874.js";import"./VDivider-b50e760e.js";import"./VChip-72049b16.js";import"./VSlideGroup-fed781fe.js";const Se=f=>(ce("data-v-9d362555"),f=f(),ve(),f),Ue=Se(()=>ge("h1",{class:"text-center mt-4"},"開放時段管理",-1)),Ae={__name:"AppointmentsView",setup(f){const{apiAuth:B}=le(),I=ae(),J=["新手友善","男女混打","僅限女生","僅限男生","宵夜場","早場","一般場","高手場","未開放","只開放季打","徵臨打"],V=u(!1),m=u(""),N=t=>{t?(m.value=t._id,y.value.value=t.court,p.value.value=t.date,h.value.value=t.begin,k.value.value=t.end,_.value.value=t.peoplenumber,x.value.value=t.info,w.value.value=t.height,C.value.value=t.online):m.value="",V.value=!0},H=()=>{V.value=!1,j()},K=["女網","男網"],O=["A","未開放"],Q=be({court:b().required("場地，必填"),date:fe().required("缺少日期"),begin:b().required("缺少開始時間"),end:b().required("缺少結束時間"),peoplenumber:Ve().typeError("開放名額格式錯誤").required("缺少開放名額").min(0,"開放名額不能小於0"),info:ye().max(3,"最多選三項").of(b().required("此欄位為必填")).required("此欄位為必填"),height:b().required("缺少網高").test("isHeight","網高分類錯誤",t=>K.includes(t)),online:he()}),{handleSubmit:X,isSubmitting:q,resetForm:j}=ke({validationSchema:Q,initialValues:{court:"A",date:new Date,begin:"12:00",end:"12:00",peoplenumber:15,height:"",online:!0}}),y=i("court"),p=i("date"),h=i("begin"),k=i("end"),_=i("peoplenumber"),x=i("info"),w=i("height"),C=i("online"),G=X(async t=>{var l,e;try{m.value===""?await B.post("/appointments",{court:t.court,date:p.value.value,begin:t.begin,end:t.end,peoplenumber:t.peoplenumber,info:t.info,height:t.height,online:t.online}):await B.patch("/appointments/"+m.value,{court:t.court,date:p.value.value,begin:t.begin,end:t.end,peoplenumber:t.peoplenumber,info:t.info,height:t.height,online:t.online}),I({text:m.value===""?"新增成功":"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),H(),F()}catch(d){console.log("更新表格回到第一頁錯誤");const n=((e=(l=d==null?void 0:d.response)==null?void 0:l.data)==null?void 0:e.message)||"發生錯誤，請稍後再試";I({text:n,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),M=u(10),S=u([{key:"createdAt",order:"desc"}]),U=u(1),D=u([]),Y=[{title:"日期",align:"center",sortable:!0,key:"date"},{title:"開始",align:"center",sortable:!0,key:"begin"},{title:"結束",align:"center",sortable:!0,key:"end"},{title:"名額",align:"center",sortable:!0,key:"peoplenumber"},{title:"網高",align:"center",sortable:!0,key:"height"},{title:"上線",align:"center",sortable:!0,key:"online"},{title:"場地",align:"center",sortable:!1,key:"court"},{title:"編輯",align:"center",sortable:!1,key:"edit"}],$=u(!0),R=u(0),A=u(""),v=async()=>{var t,l,e,d;$.value=!0;try{const{data:n}=await B.get("/appointments/all",{params:{page:U.value,itemsPerPage:M.value,sortBy:((t=S.value[0])==null?void 0:t.key)||"createdAt",sortOrder:((l=S.value[0])==null?void 0:l.order)==="asc"?1:-1,search:A.value}});D.value.splice(0,D.value.length,...n.result.data),R.value=n.result.total}catch(n){console.log(n);const Z=((d=(e=n==null?void 0:n.response)==null?void 0:e.data)==null?void 0:d.message)||"發生錯誤，請稍後再試";I({text:Z,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}$.value=!1};v();const F=()=>{U.value=1,v()};return(t,l)=>(W(),z(xe,null,{default:o(()=>[a(L,{class:"row"},{default:o(()=>[a(r,{cols:"12"},{default:o(()=>[Ue]),_:1}),a(r,{cols:"12"},{default:o(()=>[a(we,{"items-per-page":M.value,"onUpdate:itemsPerPage":[l[2]||(l[2]=e=>M.value=e),v],"sort-by":S.value,"onUpdate:sortBy":[l[3]||(l[3]=e=>S.value=e),v],page:U.value,"onUpdate:page":[l[4]||(l[4]=e=>U.value=e),v],items:D.value,headers:Y,loading:$.value,"items-length":R.value,search:A.value,hover:""},{top:o(()=>[a(L,null,{default:o(()=>[a(r,{cols:"12",xl:"3",md:"3",sm:"7"},{default:o(()=>[a(P,{"prepend-icon":"mdi-plus",color:"#1565C0",height:"40",rounded:"xl",block:"",class:"mt-3",onClick:l[0]||(l[0]=e=>N())},{default:o(()=>[c("新增時段")]),_:1})]),_:1}),a(r,{cols:"12",xl:"9",md:"9",sm:"5"},{default:o(()=>[a(g,{label:"搜尋","append-icon":"mdi-magnify",modelValue:A.value,"onUpdate:modelValue":l[1]||(l[1]=e=>A.value=e),variant:"underlined","onClick:append":F,onKeydown:te(F,["enter"])},null,8,["modelValue"])]),_:1})]),_:1})]),"item.date":o(({item:e})=>[c(E(new Date(e.date).toLocaleDateString()),1)]),"item.online":o(({item:e})=>[e.online?(W(),z(oe,{key:0},{default:o(()=>[c("mdi-check")]),_:1})):se("",!0)]),"item.edit":o(({item:e})=>[a(P,{icon:"mdi-pencil",variant:"text",color:"#1565C0",onClick:d=>N(e)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1}),a(pe,{modelValue:V.value,"onUpdate:modelValue":l[13]||(l[13]=e=>V.value=e),persistent:"",width:"600px"},{default:o(()=>[a(_e,{disabled:s(q),onSubmit:re(s(G),["prevent"])},{default:o(()=>[a(ne,null,{default:o(()=>[a(ue,null,{default:o(()=>[c(E(m.value===""?"新增時段場次":"編輯時段場次"),1)]),_:1}),a(ie,null,{default:o(()=>[a(L,null,{default:o(()=>[a(r,{cols:"12"},{default:o(()=>[a(T,{label:"場地",items:O,modelValue:s(y).value.value,"onUpdate:modelValue":l[5]||(l[5]=e=>s(y).value.value=e),"error-messages":s(y).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),a(r,{cols:"12",sm:"12"},{default:o(()=>[a(g,{label:"日期",type:"date",modelValue:s(p).value.value,"onUpdate:modelValue":l[6]||(l[6]=e=>s(p).value.value=e),"error-messages":s(p).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),a(r,{cols:"12",sm:"6"},{default:o(()=>[a(g,{label:"開始時間",type:"time",modelValue:s(h).value.value,"onUpdate:modelValue":l[7]||(l[7]=e=>s(h).value.value=e),"error-messages":s(h).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),a(r,{cols:"12",sm:"6"},{default:o(()=>[a(g,{label:"結束時間",type:"time",modelValue:s(k).value.value,"onUpdate:modelValue":l[8]||(l[8]=e=>s(k).value.value=e),"error-messages":s(k).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),a(r,{cols:"12",sm:"6"},{default:o(()=>[a(g,{label:"開放名額",type:"number",min:"0",modelValue:s(_).value.value,"onUpdate:modelValue":l[9]||(l[9]=e=>s(_).value.value=e),"error-messages":s(_).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),a(r,{cols:"12",sm:"6"},{default:o(()=>[a(T,{label:"網高",items:K,modelValue:s(w).value.value,"onUpdate:modelValue":l[10]||(l[10]=e=>s(w).value.value=e),"error-messages":s(w).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),a(r,{cols:"12"},{default:o(()=>[a(T,{label:"說明",items:J,modelValue:s(x).value.value,"onUpdate:modelValue":l[11]||(l[11]=e=>s(x).value.value=e),multiple:"",chips:"","error-messages":s(x).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),a(Ce,{label:"上線",modelValue:s(C).value.value,"onUpdate:modelValue":l[12]||(l[12]=e=>s(C).value.value=e),"error-messages":s(C).errorMessage.value,class:"ml-2"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),a(de,null,{default:o(()=>[a(me),a(P,{color:"red",disabled:s(q),onClick:H},{default:o(()=>[c("取消")]),_:1},8,["disabled"]),a(P,{color:"green",type:"submit",loading:s(q)},{default:o(()=>[c("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])]),_:1}))}},He=ee(Ae,[["__scopeId","data-v-9d362555"]]);export{He as default};
