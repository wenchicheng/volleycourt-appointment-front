import{an as $,ae as N,ao as W,ad as z,x as g,o as C,A as D,af as y,ar as b,al as u,c as a,ah as c,at as R,a6 as T,am as j,az as p,J as m,ak as w,aA as E,aB as F}from"./index-60e1a22a.js";import{V as J}from"./VContainer-6cd06bcc.js";import{V as L}from"./VRow-56ef9290.js";import{V as k}from"./VCol-a95e67cc.js";import{V as M}from"./VDataTable-ed5b30b6.js";import"./VList-cf4f50da.js";import"./VDivider-6faafa5f.js";import"./VChip-83d8daf9.js";import"./VSlideGroup-3ca9bf34.js";const V=d=>(E("data-v-ab496f9f"),d=d(),F(),d),U=V(()=>u("div",{class:"top-block"},null,-1)),G=V(()=>u("h1",{class:"text-center mt-15 mb-5",style:{color:"rgb(26, 108, 163)"}},"購物車",-1)),H={key:0},K={key:1,class:"text-red text-decoration-line-through"},O={class:"number-box"},Q={class:"mb-4"},X={__name:"CartView",setup(d){const{apiAuth:_}=j(),r=N(),h=W(),x=z(),s=g([]),B=[{title:"商品名稱",key:"product.name"},{title:"單價",key:"product.price"},{title:"數量",key:"quantity"},{title:"總價",key:"total",value:e=>e.product.price*e.quantity},{title:"操作",key:"action"}],S=C(()=>s.value.reduce((e,o)=>e+o.quantity*o.product.price,0)),q=C(()=>s.value.length>0&&!s.value.some(e=>!e.product.sell)),f=async(e,o)=>{var t,n;if(!h.isLogin){x.push("/login");return}try{const{data:l}=await _.patch("/users/cart",{product:e,quantity:o});h.cart=l.result,r({text:"修改成功",showCloseButton:!1,snackbarProps:{timeout:1e3,color:"green",location:"bottom"}});const i=s.value.findIndex(A=>A.product._id===e);s.value[i].quantity+=o,s.value[i].quantity<=0&&s.value.splice(i,1)}catch(l){const i=((n=(t=l==null?void 0:l.response)==null?void 0:t.data)==null?void 0:n.message)||"發生錯誤，請稍後再試";r({text:i,showCloseButton:!1,snackbarProps:{timeout:1500,color:"red",location:"bottom"}})}},v=g(!1),I=async()=>{var e,o;v.value=!0;try{await _.post("/orders"),h.cart=0,x.push("/orders"),r({text:"結帳成功",showCloseButton:!1,snackbarProps:{timeout:1500,color:"green",location:"bottom"}})}catch(t){const n=((o=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:o.message)||"發生錯誤，請稍後再試";r({text:n,showCloseButton:!1,snackbarProps:{timeout:1500,color:"red",location:"bottom"}})}v.value=!1};D(async()=>{var e,o;try{const{data:t}=await _.get("/users/cart");s.value.push(...t.result)}catch(t){const n=((o=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:o.message)||"發生錯誤，請稍後再試";r({text:n,showCloseButton:!1,snackbarProps:{timeout:1500,color:"red",location:"bottom"}})}});const P=()=>{const e=window.innerWidth;return e>=1200?"70%":e>=960?"80%":e>=600?"85%":"90%"};return(e,o)=>(y(),b(T,null,[U,u("div",null,[a(J,{class:"h-100 d-flex justify-center align-center",style:R({width:P()})},{default:c(()=>[a(L,{class:"row"},{default:c(()=>[a(k,{cols:"12"},{default:c(()=>[G]),_:1}),a(k,{cols:"12"},{default:c(()=>[a(M,{items:s.value,headers:B},{"item.product.name":c(({item:t})=>[t.product.sell?(y(),b("span",H,p(t.product.name),1)):(y(),b("span",K,p(t.product.name)+" (已下架)",1))]),"item.quantity":c(({item:t})=>[u("div",O,[a(m,{variant:"text",icon:"mdi-minus",color:"red",onClick:n=>f(t.product._id,-1)},null,8,["onClick"]),w(" "+p(t.quantity)+" ",1),a(m,{variant:"text",icon:"mdi-plus",color:"green",onClick:n=>f(t.product._id,1)},null,8,["onClick"])])]),"item.action":c(({item:t})=>[a(m,{variant:"text",icon:"mdi-delete",color:"rgb(26, 108, 163)",onClick:n=>f(t.product._id,t.quantity*-1)},null,8,["onClick"])]),_:1},8,["items"])]),_:1}),a(k,{class:"text-center",cols:"12"},{default:c(()=>[u("h2",Q,"總金額: $ "+p(S.value)+" 元",1),a(m,{color:"green",class:"mb-4",disabled:!q.value,loading:v.value,onClick:I},{default:c(()=>[w(" 結帳")]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["style"])])],64))}},rt=$(X,[["__scopeId","data-v-ab496f9f"]]);export{rt as default};
