import{an as ae,ae as le,x as u,af as j,ag as z,ah as o,am as te,c as a,J as B,ak as v,aj as g,b8 as oe,az as J,W as se,ay as re,ai as s,a$ as ne,aw as ue,aD as ie,al as O,ax as de,aE as me,aM as pe,av as ce,aA as ve,aB as ge}from"./index-60e1a22a.js";import{c as be,a as b,f as fe,e as Ve,h as ye,i as he,u as ke,d as i,V as _e}from"./index.esm-52dc4aed.js";import{V as xe}from"./VContainer-6cd06bcc.js";import{V as r}from"./VCol-a95e67cc.js";import{V as we,a as Ce}from"./VDataTableServer-76a6d6d0.js";import{V as T}from"./VRow-56ef9290.js";import{a as L}from"./VDataTable-ed5b30b6.js";import"./VList-cf4f50da.js";import"./VDivider-6faafa5f.js";import"./VChip-83d8daf9.js";import"./VSlideGroup-3ca9bf34.js";const Se=f=>(ve("data-v-cc0c52c2"),f=f(),ge(),f),Ae=Se(()=>O("h1",{class:"text-center mt-4"},"開放時段管理",-1)),Ue={class:"text-center"},Be={__name:"AppointmentsView",setup(f){const{apiAuth:P}=te(),I=le(),R=["新手友善","男女混打","僅限女生","僅限男生","宵夜場","早場","一般場","高手場","未開放","只開放季打","徵臨打"],V=u(!1),m=u(""),N=t=>{t?(m.value=t._id,y.value.value=t.court,p.value.value=t.date,h.value.value=t.begin,k.value.value=t.end,_.value.value=t.peoplenumber,x.value.value=t.info,w.value.value=t.height,C.value.value=t.online):m.value="",V.value=!0},E=()=>{V.value=!1,X()},H=["女網","男網"],W=["A","未開放"],G=be({court:b().required("場地，必填"),date:fe().required("缺少日期"),begin:b().required("缺少開始時間"),end:b().required("缺少結束時間"),peoplenumber:Ve().typeError("開放名額格式錯誤").required("缺少開放名額").min(0,"開放名額不能小於0"),info:ye().max(3,"最多選三項").of(b().required("此欄位為必填")).required("此欄位為必填"),height:b().required("缺少網高").test("isHeight","網高分類錯誤",t=>H.includes(t)),online:he()}),{handleSubmit:Q,isSubmitting:M,resetForm:X}=ke({validationSchema:G,initialValues:{court:"A",date:new Date,begin:"12:00",end:"12:00",peoplenumber:15,height:"",online:!0}}),y=i("court"),p=i("date"),h=i("begin"),k=i("end"),_=i("peoplenumber"),x=i("info"),w=i("height"),C=i("online"),Y=Q(async t=>{var l,e;try{m.value===""?await P.post("/appointments",{court:t.court,date:p.value.value,begin:t.begin,end:t.end,peoplenumber:t.peoplenumber,info:t.info,height:t.height,online:t.online}):await P.patch("/appointments/"+m.value,{court:t.court,date:p.value.value,begin:t.begin,end:t.end,peoplenumber:t.peoplenumber,info:t.info,height:t.height,online:t.online}),I({text:m.value===""?"新增成功":"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),E(),F()}catch(d){console.log("更新表格回到第一頁錯誤");const n=((e=(l=d==null?void 0:d.response)==null?void 0:l.data)==null?void 0:e.message)||"發生錯誤，請稍後再試";I({text:n,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),D=u(10),S=u([{key:"createdAt",order:"desc"}]),A=u(1),$=u([]),Z=[{title:"日期",align:"center",sortable:!0,key:"date"},{title:"開始",align:"center",sortable:!0,key:"begin"},{title:"結束",align:"center",sortable:!0,key:"end"},{title:"名額",align:"center",sortable:!0,key:"peoplenumber"},{title:"網高",align:"center",sortable:!0,key:"height"},{title:"上線",align:"center",sortable:!0,key:"online"},{title:"場地",align:"center",sortable:!1,key:"court"},{title:"編輯",align:"center",sortable:!1,key:"edit"}],q=u(!0),K=u(0),U=u(""),c=async()=>{var t,l,e,d;q.value=!0;try{const{data:n}=await P.get("/appointments/all",{params:{page:A.value,itemsPerPage:D.value,sortBy:((t=S.value[0])==null?void 0:t.key)||"createdAt",sortOrder:((l=S.value[0])==null?void 0:l.order)==="asc"?1:-1,search:U.value}});$.value.splice(0,$.value.length,...n.result.data),K.value=n.result.total}catch(n){console.log(n);const ee=((d=(e=n==null?void 0:n.response)==null?void 0:e.data)==null?void 0:d.message)||"發生錯誤，請稍後再試";I({text:ee,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}q.value=!1};c();const F=()=>{A.value=1,c()};return(t,l)=>(j(),z(xe,null,{default:o(()=>[a(T,{class:"row"},{default:o(()=>[a(r,{cols:"12"},{default:o(()=>[Ae]),_:1}),a(r,{cols:"12"},{default:o(()=>[a(we,{"items-per-page":D.value,"onUpdate:itemsPerPage":[l[2]||(l[2]=e=>D.value=e),c],"sort-by":S.value,"onUpdate:sortBy":[l[3]||(l[3]=e=>S.value=e),c],page:A.value,"onUpdate:page":[l[4]||(l[4]=e=>A.value=e),c],items:$.value,headers:Z,loading:q.value,"items-length":K.value,search:U.value,hover:""},{top:o(()=>[a(T,null,{default:o(()=>[a(r,{cols:"12",xl:"3",md:"3",sm:"7"},{default:o(()=>[a(B,{"prepend-icon":"mdi-plus",color:"#1565C0",height:"40",rounded:"xl",block:"",class:"mt-3",onClick:l[0]||(l[0]=e=>N())},{default:o(()=>[v("新增時段")]),_:1})]),_:1}),a(r,{cols:"12",xl:"9",md:"9",sm:"5"},{default:o(()=>[a(g,{label:"搜尋","append-icon":"mdi-magnify",modelValue:U.value,"onUpdate:modelValue":l[1]||(l[1]=e=>U.value=e),variant:"underlined","onClick:append":F,onKeydown:oe(F,["enter"])},null,8,["modelValue"])]),_:1})]),_:1})]),"item.date":o(({item:e})=>[v(J(new Date(e.date).toLocaleDateString()),1)]),"item.online":o(({item:e})=>[e.online?(j(),z(se,{key:0},{default:o(()=>[v("mdi-check")]),_:1})):re("",!0)]),"item.edit":o(({item:e})=>[a(B,{icon:"mdi-pencil",variant:"text",color:"#1565C0",onClick:d=>N(e)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1}),a(ce,{modelValue:V.value,"onUpdate:modelValue":l[13]||(l[13]=e=>V.value=e),persistent:"",width:"600px"},{default:o(()=>[a(_e,{disabled:s(M),onSubmit:ne(s(Y),["prevent"])},{default:o(()=>[a(ue,{style:{padding:"16px"}},{default:o(()=>[a(ie,null,{default:o(()=>[O("h3",Ue,J(m.value===""?"新增時段場次":"編輯時段場次"),1)]),_:1}),a(de,null,{default:o(()=>[a(T,null,{default:o(()=>[a(r,{cols:"12"},{default:o(()=>[a(L,{label:"場地",items:W,modelValue:s(y).value.value,"onUpdate:modelValue":l[5]||(l[5]=e=>s(y).value.value=e),"error-messages":s(y).errorMessage.value,variant:"outlined",elevation:"0"},null,8,["modelValue","error-messages"])]),_:1}),a(r,{cols:"12",sm:"12"},{default:o(()=>[a(g,{label:"日期",type:"date",modelValue:s(p).value.value,"onUpdate:modelValue":l[6]||(l[6]=e=>s(p).value.value=e),"error-messages":s(p).errorMessage.value,variant:"outlined"},null,8,["modelValue","error-messages"])]),_:1}),a(r,{cols:"12",sm:"6"},{default:o(()=>[a(g,{label:"開始時間",type:"time",modelValue:s(h).value.value,"onUpdate:modelValue":l[7]||(l[7]=e=>s(h).value.value=e),"error-messages":s(h).errorMessage.value,variant:"outlined"},null,8,["modelValue","error-messages"])]),_:1}),a(r,{cols:"12",sm:"6"},{default:o(()=>[a(g,{label:"結束時間",type:"time",modelValue:s(k).value.value,"onUpdate:modelValue":l[8]||(l[8]=e=>s(k).value.value=e),"error-messages":s(k).errorMessage.value,variant:"outlined"},null,8,["modelValue","error-messages"])]),_:1}),a(r,{cols:"12",sm:"6"},{default:o(()=>[a(g,{label:"開放名額",type:"number",min:"0",modelValue:s(_).value.value,"onUpdate:modelValue":l[9]||(l[9]=e=>s(_).value.value=e),"error-messages":s(_).errorMessage.value,variant:"outlined"},null,8,["modelValue","error-messages"])]),_:1}),a(r,{cols:"12",sm:"6"},{default:o(()=>[a(L,{label:"網高",items:H,modelValue:s(w).value.value,"onUpdate:modelValue":l[10]||(l[10]=e=>s(w).value.value=e),"error-messages":s(w).errorMessage.value,variant:"outlined"},null,8,["modelValue","error-messages"])]),_:1}),a(r,{cols:"12"},{default:o(()=>[a(L,{label:"說明",items:R,modelValue:s(x).value.value,"onUpdate:modelValue":l[11]||(l[11]=e=>s(x).value.value=e),multiple:"",chips:"","error-messages":s(x).errorMessage.value,variant:"outlined"},null,8,["modelValue","error-messages"])]),_:1}),a(Ce,{label:"上線",modelValue:s(C).value.value,"onUpdate:modelValue":l[12]||(l[12]=e=>s(C).value.value=e),"error-messages":s(C).errorMessage.value,class:"ml-2"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),a(me,null,{default:o(()=>[a(pe),a(B,{color:"red",disabled:s(M),onClick:E},{default:o(()=>[v("取消")]),_:1},8,["disabled"]),a(B,{color:"green",type:"submit",loading:s(M)},{default:o(()=>[v("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])]),_:1}))}},He=ae(Be,[["__scopeId","data-v-cc0c52c2"]]);export{He as default};
