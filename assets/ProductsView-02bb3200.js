import{p as de,b9 as ce,ba as ve,g as me,bb as fe,D as ge,bc as pe,o as E,x as c,s as Ve,H as xe,A as be,z as U,B as ye,u as we,bd as he,be as ae,bf as Ce,c as t,bg as ke,G as K,a6 as J,T as te,_ as Pe,bh as _e,bi as Fe,a7 as Se,a4 as W,bj as Ie,v as Be,y as Me,an as Re,ae as Ae,aq as Ue,af as le,ag as oe,ah as r,am as Te,J as G,ak as T,aj as Q,b8 as De,V as ze,W as Ne,ay as He,ai as i,a$ as $e,aw as Ee,aD as Ge,az as qe,ax as je,aE as Oe,aM as Le,av as Ke,aA as Je,aB as We,al as Qe}from"./index-60e1a22a.js";import{c as Xe,a as X,e as Ye,i as Ze,u as ea,d as D,V as aa}from"./index.esm-52dc4aed.js";import{V as ta}from"./VContainer-6cd06bcc.js";import{V as q}from"./VCol-a95e67cc.js";import{V as la,a as oa}from"./VDataTableServer-76a6d6d0.js";import{V as ne}from"./VRow-56ef9290.js";import{a as na}from"./VDataTable-ed5b30b6.js";import"./VList-cf4f50da.js";import"./VDivider-6faafa5f.js";import"./VChip-83d8daf9.js";import"./VSlideGroup-3ca9bf34.js";const sa=de({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...ce(),...ve()},"VTextarea"),ra=me()({name:"VTextarea",directives:{Intersect:fe},inheritAttrs:!1,props:sa(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,B){let{attrs:P,emit:M,slots:m}=B;const d=ge(e,"modelValue"),{isFocused:w,focus:z,blur:N}=pe(e),j=E(()=>typeof e.counterValue=="function"?e.counterValue(d.value):(d.value||"").toString().length),O=E(()=>{if(P.maxlength)return P.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function R(n,v){var u,f;!e.autofocus||!n||(f=(u=v[0].target)==null?void 0:u.focus)==null||f.call(u)}const H=c(),x=c(),_=Ve(""),b=c(),S=E(()=>e.persistentPlaceholder||w.value||e.active);function h(){var n;b.value!==document.activeElement&&((n=b.value)==null||n.focus()),w.value||z()}function C(n){h(),M("click:control",n)}function $(n){M("mousedown:control",n)}function L(n){n.stopPropagation(),h(),W(()=>{d.value="",Ie(e["onClick:clear"],n)})}function A(n){var u;const v=n.target;if(d.value=v.value,(u=e.modelModifiers)!=null&&u.trim){const f=[v.selectionStart,v.selectionEnd];W(()=>{v.selectionStart=f[0],v.selectionEnd=f[1]})}}const p=c(),y=c(+e.rows),F=E(()=>["plain","underlined"].includes(e.variant));xe(()=>{e.autoGrow||(y.value=+e.rows)});function k(){e.autoGrow&&W(()=>{if(!p.value||!x.value)return;const n=getComputedStyle(p.value),v=getComputedStyle(x.value.$el),u=parseFloat(n.getPropertyValue("--v-field-padding-top"))+parseFloat(n.getPropertyValue("--v-input-padding-top"))+parseFloat(n.getPropertyValue("--v-field-padding-bottom")),f=p.value.scrollHeight,s=parseFloat(n.lineHeight),l=Math.max(parseFloat(e.rows)*s+u,parseFloat(v.getPropertyValue("--v-input-control-height"))),V=parseFloat(e.maxRows)*s+u||1/0,a=Me(f??0,l,V);y.value=Math.floor((a-u)/s),_.value=Be(a)})}be(k),U(d,k),U(()=>e.rows,k),U(()=>e.maxRows,k),U(()=>e.density,k);let g;return U(p,n=>{n?(g=new ResizeObserver(k),g.observe(p.value)):g==null||g.disconnect()}),ye(()=>{g==null||g.disconnect()}),we(()=>{const n=!!(m.counter||e.counter||e.counterValue),v=!!(n||m.details),[u,f]=he(P),{modelValue:s,...l}=ae.filterProps(e),V=Ce(e);return t(ae,K({ref:H,modelValue:d.value,"onUpdate:modelValue":a=>d.value=a,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":F.value},e.class],style:e.style},u,l,{centerAffix:y.value===1&&!F.value,focused:w.value}),{...m,default:a=>{let{id:o,isDisabled:I,isDirty:Y,isReadonly:se,isValid:re}=a;return t(ke,K({ref:x,style:{"--v-textarea-control-height":_.value},onClick:C,onMousedown:$,"onClick:clear":L,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},V,{id:o.value,active:S.value||Y.value,centerAffix:y.value===1&&!F.value,dirty:Y.value||e.dirty,disabled:I.value,focused:w.value,error:re.value===!1}),{...m,default:ue=>{let{props:{class:Z,...ee}}=ue;return t(J,null,[e.prefix&&t("span",{class:"v-text-field__prefix"},[e.prefix]),te(t("textarea",K({ref:b,class:Z,value:d.value,onInput:A,autofocus:e.autofocus,readonly:se.value,disabled:I.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:h,onBlur:N},ee,f),null),[[Pe("intersect"),{handler:R},null,{once:!0}]]),e.autoGrow&&te(t("textarea",{class:[Z,"v-textarea__sizer"],id:`${ee.id}-sizer`,"onUpdate:modelValue":ie=>d.value=ie,ref:p,readonly:!0,"aria-hidden":"true"},null),[[_e,d.value]]),e.suffix&&t("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:v?a=>{var o;return t(J,null,[(o=m.details)==null?void 0:o.call(m,a),n&&t(J,null,[t("span",null,null),t(Fe,{active:e.persistentCounter||w.value,value:j.value,max:O.value},m.counter)])])}:void 0})}),Se({},H,x,b)}});const ua=e=>(Je("data-v-3f7a5b70"),e=e(),We(),e),ia=ua(()=>Qe("h1",{class:"text-center mt-4"},"商品管理",-1)),da={__name:"ProductsView",setup(e){const{apiAuth:B}=Te(),P=Ae(),M=c(null),m=c(!1),d=c(""),w=s=>{console.log('點擊"新增商品"'),s?(d.value=s._id,x.value.value=s.name,_.value.value=s.price,b.value.value=s.description,S.value.value=s.category,h.value.value=s.sell):d.value="",m.value=!0},z=()=>{m.value=!1,H(),M.value.deleteFileRecord()},N=["排球衣","排球褲","排球襪","排球鞋","球具","配件"],j=Xe({name:X().required("缺少商品名稱"),price:Ye().typeError("商品價格格式錯誤").required("缺少商品價格").min(0,"商品價格不能小於 0"),description:X().required("缺少商品說明"),category:X().required("缺少商品分類").test("isCategory","商品分類錯誤",s=>N.includes(s)),sell:Ze()}),{handleSubmit:O,isSubmitting:R,resetForm:H}=ea({validationSchema:j,initialValues:{name:"",price:0,description:"",category:"",sell:!1}}),x=D("name"),_=D("price"),b=D("description"),S=D("category"),h=D("sell"),C=c([]),$=c([]),L=O(async s=>{var l,V,a;if(!((l=C.value[0])!=null&&l.error)&&!(d.value===""&&C.value.length===0))try{const o=new FormData;o.append("name",s.name),o.append("price",s.price),o.append("description",s.description),o.append("category",s.category),o.append("sell",s.sell),C.value.length>0&&o.append("image",C.value[0].file),d.value===""?await B.post("/products",o):await B.patch("/products/"+d.value,o),P({text:d.value===""?"新增成功":"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),z(),f()}catch(o){console.log(o);const I=((a=(V=o==null?void 0:o.response)==null?void 0:V.data)==null?void 0:a.message)||"發生錯誤，請稍後再試";P({text:I,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),A=c(10),p=c([{key:"createdAt",order:"desc"}]),y=c(1),F=c([]),k=[{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"名稱",align:"left",sortable:!0,key:"name"},{title:"價格",align:"center",sortable:!0,key:"price"},{title:"分類",align:"center",sortable:!0,key:"category"},{title:"上架",align:"center",sortable:!0,key:"sell"},{title:"編輯",align:"center",sortable:!1,key:"edit"}],g=c(!0),n=c(0),v=c(""),u=async()=>{var s,l,V,a;g.value=!0;try{const{data:o}=await B.get("/products/all",{params:{page:y.value,itemsPerPage:A.value,sortBy:((s=p.value[0])==null?void 0:s.key)||"createdAt",sortOrder:((l=p.value[0])==null?void 0:l.order)==="asc"?1:-1,search:v.value}});F.value.splice(0,F.value.length,...o.result.data),n.value=o.result.total}catch(o){console.log(o);const I=((a=(V=o==null?void 0:o.response)==null?void 0:V.data)==null?void 0:a.message)||"發生錯誤，請稍後再試";P({text:I,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}g.value=!1};u();const f=()=>{y.value=1,u()};return(s,l)=>{const V=Ue("vue-file-agent");return le(),oe(ta,null,{default:r(()=>[t(ne,{class:"row"},{default:r(()=>[t(q,{cols:"12"},{default:r(()=>[ia]),_:1}),t(q,{cols:"12"},{default:r(()=>[t(la,{"items-per-page":A.value,"onUpdate:itemsPerPage":[l[2]||(l[2]=a=>A.value=a),u],"sort-by":p.value,"onUpdate:sortBy":[l[3]||(l[3]=a=>p.value=a),u],page:y.value,"onUpdate:page":[l[4]||(l[4]=a=>y.value=a),u],items:F.value,headers:k,loading:g.value,"items-length":n.value,search:v.value,hover:""},{top:r(()=>[t(ne,null,{default:r(()=>[t(q,{cols:"3",xl:"2",md:"2",sm:"4"},{default:r(()=>[t(G,{"prepend-icon":"mdi-plus",color:"#1565C0",height:"40",rounded:"xl",block:"",class:"mt-3",onClick:l[0]||(l[0]=a=>w())},{default:r(()=>[T("新增商品")]),_:1})]),_:1}),t(q,{cols:"9",xl:"10",md:"10",sm:"8"},{default:r(()=>[t(Q,{label:"搜尋","append-icon":"mdi-magnify",modelValue:v.value,"onUpdate:modelValue":l[1]||(l[1]=a=>v.value=a),variant:"underlined","onClick:append":f,onKeydown:De(f,["enter"])},null,8,["modelValue"])]),_:1})]),_:1})]),"item.image":r(({item:a})=>[t(ze,{src:a.image,height:"60px"},null,8,["src"])]),"item.sell":r(({item:a})=>[a.sell?(le(),oe(Ne,{key:0},{default:r(()=>[T("mdi-check")]),_:1})):He("",!0)]),"item.edit":r(({item:a})=>[t(G,{icon:"mdi-pencil",variant:"text",color:"#1565C0",onClick:o=>w(a)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1}),t(Ke,{modelValue:m.value,"onUpdate:modelValue":l[12]||(l[12]=a=>m.value=a),persistent:"",width:"600px"},{default:r(()=>[t(aa,{disabled:i(R),onSubmit:$e(i(L),["prevent"])},{default:r(()=>[t(Ee,null,{default:r(()=>[t(Ge,null,{default:r(()=>[T(qe(d.value===""?"新增商品":"編輯商品"),1)]),_:1}),t(je,null,{default:r(()=>[t(Q,{label:"名稱",modelValue:i(x).value.value,"onUpdate:modelValue":l[5]||(l[5]=a=>i(x).value.value=a),"error-messages":i(x).errorMessage.value},null,8,["modelValue","error-messages"]),t(Q,{label:"價格",type:"number",min:"0",modelValue:i(_).value.value,"onUpdate:modelValue":l[6]||(l[6]=a=>i(_).value.value=a),"error-messages":i(_).errorMessage.value},null,8,["modelValue","error-messages"]),t(na,{label:"分類",items:N,modelValue:i(S).value.value,"onUpdate:modelValue":l[7]||(l[7]=a=>i(S).value.value=a),"error-messages":i(S).errorMessage.value},null,8,["modelValue","error-messages"]),t(oa,{label:"上架",modelValue:i(h).value.value,"onUpdate:modelValue":l[8]||(l[8]=a=>i(h).value.value=a),"error-messages":i(h).errorMessage.value},null,8,["modelValue","error-messages"]),t(ra,{label:"說明",modelValue:i(b).value.value,"onUpdate:modelValue":l[9]||(l[9]=a=>i(b).value.value=a),"error-messages":i(b).errorMessage.value},null,8,["modelValue","error-messages"]),t(V,{modelValue:C.value,"onUpdate:modelValue":l[10]||(l[10]=a=>C.value=a),rawModelValue:$.value,"onUpdate:rawModelValue":l[11]||(l[11]=a=>$.value=a),accept:"image/jpeg,image/png",deletable:"","error-text":{type:"檔案格式不支援",size:"檔案超過 1MB 大小限制"},"help-text":"選擇檔案或拖曳到這裡","max-files":1,"max-size":"1MB",ref_key:"fileAgent",ref:M},null,8,["modelValue","rawModelValue"])]),_:1}),t(Oe,null,{default:r(()=>[t(Le),t(G,{color:"red",disabled:i(R),onClick:z},{default:r(()=>[T("取消")]),_:1},8,["disabled"]),t(G,{color:"green",type:"submit",loading:i(R)},{default:r(()=>[T("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])]),_:1})}}},ha=Re(da,[["__scopeId","data-v-3f7a5b70"]]);export{ha as default};
