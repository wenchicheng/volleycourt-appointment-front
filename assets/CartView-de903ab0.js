import{ap as $,af as N,ad as W,ae as z,x,o as C,A as D,ag as y,ar as k,an as u,c as a,ai as n,at as R,a6 as T,ao as j,az as p,J as m,am as w,aA as E,aB as F}from"./index-3641e5fd.js";import{V as J}from"./VContainer-d2153b8b.js";import{V as L}from"./VRow-b8ec82be.js";import{V as b}from"./VCol-d0e9c4cc.js";import{V as M}from"./VDataTable-ffc2f22e.js";import"./VList-5bc1dd5c.js";import"./VDivider-40b9137b.js";import"./VChip-ad6e9837.js";import"./VSlideGroup-e8841b7a.js";const V=d=>(E("data-v-78f59ecd"),d=d(),F(),d),U=V(()=>u("div",{class:"top-block"},null,-1)),G=V(()=>u("h1",{class:"text-center mt-15 mb-5",style:{color:"rgb(70, 70, 70)"}},"購物車",-1)),H={key:0},K={key:1,class:"text-red text-decoration-line-through"},O={class:"number-box"},Q={class:"mb-4"},X={__name:"CartView",setup(d){const{apiAuth:_}=j(),r=N(),h=W(),g=z(),s=x([]),B=[{title:"商品名稱",key:"product.name"},{title:"單價",key:"product.price"},{title:"數量",key:"quantity"},{title:"總價",key:"total",value:e=>e.product.price*e.quantity},{title:"操作",key:"action"}],S=C(()=>s.value.reduce((e,o)=>e+o.quantity*o.product.price,0)),q=C(()=>s.value.length>0&&!s.value.some(e=>!e.product.sell)),f=async(e,o)=>{var t,c;if(!h.isLogin){g.push("/login");return}try{const{data:l}=await _.patch("/users/cart",{product:e,quantity:o});h.cart=l.result,r({text:"修改成功",showCloseButton:!1,snackbarProps:{timeout:1e3,color:"green",location:"bottom"}});const i=s.value.findIndex(A=>A.product._id===e);s.value[i].quantity+=o,s.value[i].quantity<=0&&s.value.splice(i,1)}catch(l){const i=((c=(t=l==null?void 0:l.response)==null?void 0:t.data)==null?void 0:c.message)||"發生錯誤，請稍後再試";r({text:i,showCloseButton:!1,snackbarProps:{timeout:1500,color:"red",location:"bottom"}})}},v=x(!1),I=async()=>{var e,o;v.value=!0;try{await _.post("/orders"),h.cart=0,g.push("/orders"),r({text:"結帳成功",showCloseButton:!1,snackbarProps:{timeout:1500,color:"green",location:"bottom"}})}catch(t){const c=((o=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:o.message)||"發生錯誤，請稍後再試";r({text:c,showCloseButton:!1,snackbarProps:{timeout:1500,color:"red",location:"bottom"}})}v.value=!1};D(async()=>{var e,o;try{const{data:t}=await _.get("/users/cart");s.value.push(...t.result)}catch(t){const c=((o=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:o.message)||"發生錯誤，請稍後再試";r({text:c,showCloseButton:!1,snackbarProps:{timeout:1500,color:"red",location:"bottom"}})}});const P=()=>{const e=window.innerWidth;return e>=1200?"70%":e>=960?"80%":e>=600?"85%":"90%"};return(e,o)=>(y(),k(T,null,[U,u("div",null,[a(J,{class:"h-100 d-flex justify-center align-center",style:R({width:P()})},{default:n(()=>[a(L,{class:"row"},{default:n(()=>[a(b,{cols:"12"},{default:n(()=>[G]),_:1}),a(b,{cols:"12"},{default:n(()=>[a(M,{items:s.value,headers:B},{"item.product.name":n(({item:t})=>[t.product.sell?(y(),k("span",H,p(t.product.name),1)):(y(),k("span",K,p(t.product.name)+" (已下架)",1))]),"item.quantity":n(({item:t})=>[u("div",O,[a(m,{variant:"text",icon:"mdi-minus",color:"red",onClick:c=>f(t.product._id,-1)},null,8,["onClick"]),w(" "+p(t.quantity)+" ",1),a(m,{variant:"text",icon:"mdi-plus",color:"green",onClick:c=>f(t.product._id,1)},null,8,["onClick"])])]),"item.action":n(({item:t})=>[a(m,{variant:"text",icon:"mdi-delete",color:"rgb(26, 108, 163)",onClick:c=>f(t.product._id,t.quantity*-1)},null,8,["onClick"])]),_:1},8,["items"])]),_:1}),a(b,{class:"text-center",cols:"12"},{default:n(()=>[u("h2",Q,"總金額: $ "+p(S.value)+" 元",1),a(m,{color:"green",class:"mb-4",disabled:!q.value,loading:v.value,onClick:I},{default:n(()=>[w(" 結帳")]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["style"])])],64))}},rt=$(X,[["__scopeId","data-v-78f59ecd"]]);export{rt as default};
