import{ap as R,af as L,ad as T,ae as W,x as V,o as g,A as $,ag as C,ar as w,an as p,c as t,ai as a,at as z,a6 as j,ao as E,az as B,ay as F,J as _,am as S,aw as J,aR as M,r as U,aS as G,aA as H,aB as K}from"./index-4e2a65cb.js";import{V as O}from"./VContainer-793f6ed1.js";import{V as I}from"./VRow-2cd00e23.js";import{V as s}from"./VCol-a2ca2f98.js";import{V as Q}from"./VDataTable-ce8a9e56.js";import{V as X,a as u}from"./VList-af7dfca7.js";import{V as f}from"./VDivider-d7ec31ce.js";import"./VChip-d8394318.js";import"./VSlideGroup-3e5eb4fa.js";const y=m=>(H("data-v-f26950fb"),m=m(),K(),m),Y=y(()=>p("div",{class:"top-block"},null,-1)),Z={style:{border:"2px solid rgb(4, 0, 255)"}},tt=y(()=>p("h1",{class:"text-center mt-15 mb-5",style:{color:"rgb(26, 108, 163)"}},"確認預約",-1)),et={key:0},at={class:"number-box"},ot=y(()=>p("span",{class:"text-h5"},"請再次確認以下內容",-1)),st={__name:"CheckView",setup(m){const{apiAuth:h}=E(),c=L(),v=T(),x=W(),i=V([]),q=[{title:"場地",key:"appointment.court"},{title:"日期",key:"appointment.date"},{title:"開始時間",key:"appointment.begin"},{title:"結束時間",key:"appointment.end"},{title:"人數",key:"quantity"},{title:"操作",key:"action"}];g(()=>i.value.reduce((o,n)=>o+n.quantity*n.appointment.price,0));const P=g(()=>i.value.length>0&&!i.value.some(o=>!o.appointment.sell)),b=async(o,n)=>{var e,l;if(!v.isLogin){x.push("/login");return}try{const{data:r}=await h.patch("/users/reservation",{appointment:o,quantity:n});v.reservation=r.result,c({text:"修改成功",showCloseButton:!1,snackbarProps:{timeout:1e3,color:"green",location:"bottom"}});const d=i.value.findIndex(N=>N.appointment._id===o);i.value[d].quantity+=n,i.value[d].quantity<=0&&i.value.splice(d,1)}catch(r){const d=((l=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:l.message)||"發生錯誤，請稍後再試";c({text:d,showCloseButton:!1,snackbarProps:{timeout:1500,color:"red",location:"bottom"}})}},k=V(!1),A=async()=>{var o,n;k.value=!0;try{await h.post("/orders"),v.cart=0,x.push("/orders"),c({text:"結帳成功",showCloseButton:!1,snackbarProps:{timeout:1500,color:"green",location:"bottom"}})}catch(e){const l=((n=(o=e==null?void 0:e.response)==null?void 0:o.data)==null?void 0:n.message)||"發生錯誤，請稍後再試";c({text:l,showCloseButton:!1,snackbarProps:{timeout:1500,color:"red",location:"bottom"}})}k.value=!1};$(async()=>{var o,n;try{const{data:e}=await h.get("/users/cart");cart.value.push(...e.result)}catch(e){const l=((n=(o=e==null?void 0:e.response)==null?void 0:o.data)==null?void 0:n.message)||"發生錯誤，請稍後再試";c({text:l,showCloseButton:!1,snackbarProps:{timeout:1500,color:"red",location:"bottom"}})}});const D=()=>{const o=window.innerWidth;return o>=1200?"70%":o>=960?"80%":o>=600?"85%":"90%"};return(o,n)=>(C(),w(j,null,[Y,p("div",Z,[t(O,{class:"h-100 d-flex justify-center align-center",style:z([{width:D()},{border:"2px solid #bc3636"}])},{default:a(()=>[t(I,{class:"row"},{default:a(()=>[t(s,{cols:"12"},{default:a(()=>[tt]),_:1}),t(s,{cols:"12"},{default:a(()=>[t(Q,{items:i.value,headers:q},{"item.appointment.name":a(({item:e})=>[e.appointment.sell?(C(),w("span",et,B(e.appointment.name),1)):F("",!0)]),"item.quantity":a(({item:e})=>[p("div",at,[t(_,{variant:"text",icon:"mdi-minus",color:"red",onClick:l=>b(e.appointment._id,-1)},null,8,["onClick"]),S(" "+B(e.quantity)+" ",1),t(_,{variant:"text",icon:"mdi-plus",color:"green",onClick:l=>b(e.appointment._id,1)},null,8,["onClick"])])]),"item.action":a(({item:e})=>[t(_,{variant:"text",icon:"mdi-delete",color:"rgb(26, 108, 163)",onClick:l=>b(e.appointment._id,e.quantity*-1)},null,8,["onClick"])]),_:1},8,["items"])]),_:1}),t(s,{class:"",cols:"12"},{default:a(()=>[t(J,{class:"mx-auto pa-8","max-width":"500",rounded:"xl"},{default:a(()=>[t(M,{class:"text-center"},{append:a(()=>[t(U,{defaults:{VBtn:{variant:"text",density:"comfortable"}}})]),default:a(()=>[t(G,null,{default:a(()=>[ot]),_:1})]),_:1}),t(X,{class:"overflow-hidden"},{default:a(()=>[t(I,null,{default:a(()=>[t(s,{cols:"6"},{default:a(()=>[t(u,{"prepend-icon":"mdi-email",title:"會員信箱"})]),_:1}),t(s,{cols:"6"}),t(f),t(s,{cols:"6"},{default:a(()=>[t(u,{"prepend-icon":"mdi-calendar",title:"預約日期"})]),_:1}),t(s,{cols:"6"}),t(f),t(s,{cols:"6"},{default:a(()=>[t(u,{"prepend-icon":"mdi-clock",title:"預約時間"})]),_:1}),t(s,{cols:"6"}),t(f),t(s,{cols:"6"},{default:a(()=>[t(u,{"prepend-icon":"mdi-map-marker",title:"預約場地"})]),_:1}),t(s,{cols:"6"}),t(f),t(s,{cols:"6"},{default:a(()=>[t(u,{"prepend-icon":"mdi-account-multiple",title:"預約人數"})]),_:1}),t(s,{cols:"6"})]),_:1})]),_:1})]),_:1}),t(_,{color:"green",class:"mb-4",disabled:!P.value,loading:k.value,onClick:A},{default:a(()=>[S(" 確認預約")]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["style"])])],64))}},_t=R(st,[["__scopeId","data-v-f26950fb"]]);export{_t as default};
