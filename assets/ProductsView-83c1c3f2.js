import{p as de,b8 as ce,b9 as ve,g as me,ba as fe,D as ge,bb as pe,o as G,x as c,s as Ve,H as xe,A as be,z as A,B as ye,u as we,bc as he,bd as ae,be as Ce,c as t,bf as ke,G as K,a6 as J,T as te,_ as Pe,bg as _e,bh as Se,a7 as Fe,a4 as W,bi as Ie,v as Be,y as Me,ad as Re,ae as Ue,ah as Ae,ai as le,aq as oe,ak as r,az as Te,J as E,ar as T,aZ as Y,b7 as De,V as ze,W as He,av as Ne,ap as i,aY as $e,at as Ge,aS as Ee,aw as qe,au as Oe,aT as Le,aH as je,as as Ke,ax as Je,ay as We,an as Ye}from"./index-5d05dde8.js";import{c as Ze,b as Z,a as Qe,h as Xe}from"./index.esm-195823e1.js";import{u as ea,a as D,V as aa}from"./vee-validate.esm-ed972d53.js";import{V as ta}from"./VContainer-a66adb2c.js";import{V as q}from"./VCol-82ae06b3.js";import{V as la,a as oa}from"./VDataTableServer-ffb6b132.js";import{V as ne}from"./VRow-814b2d6a.js";import{a as na}from"./VDataTable-6b507cbe.js";import"./VList-13371a02.js";import"./VDivider-0e44e418.js";import"./VChip-4fc111dc.js";import"./VSlideGroup-d8614059.js";const sa=de({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...ce(),...ve()},"VTextarea"),ra=me()({name:"VTextarea",directives:{Intersect:fe},inheritAttrs:!1,props:sa(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,B){let{attrs:P,emit:M,slots:m}=B;const d=ge(e,"modelValue"),{isFocused:w,focus:z,blur:H}=pe(e),O=G(()=>typeof e.counterValue=="function"?e.counterValue(d.value):(d.value||"").toString().length),L=G(()=>{if(P.maxlength)return P.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function R(n,v){var u,f;!e.autofocus||!n||(f=(u=v[0].target)==null?void 0:u.focus)==null||f.call(u)}const N=c(),x=c(),_=Ve(""),b=c(),F=G(()=>e.persistentPlaceholder||w.value||e.active);function h(){var n;b.value!==document.activeElement&&((n=b.value)==null||n.focus()),w.value||z()}function C(n){h(),M("click:control",n)}function $(n){M("mousedown:control",n)}function j(n){n.stopPropagation(),h(),W(()=>{d.value="",Ie(e["onClick:clear"],n)})}function U(n){var u;const v=n.target;if(d.value=v.value,(u=e.modelModifiers)!=null&&u.trim){const f=[v.selectionStart,v.selectionEnd];W(()=>{v.selectionStart=f[0],v.selectionEnd=f[1]})}}const p=c(),y=c(+e.rows),S=G(()=>["plain","underlined"].includes(e.variant));xe(()=>{e.autoGrow||(y.value=+e.rows)});function k(){e.autoGrow&&W(()=>{if(!p.value||!x.value)return;const n=getComputedStyle(p.value),v=getComputedStyle(x.value.$el),u=parseFloat(n.getPropertyValue("--v-field-padding-top"))+parseFloat(n.getPropertyValue("--v-input-padding-top"))+parseFloat(n.getPropertyValue("--v-field-padding-bottom")),f=p.value.scrollHeight,s=parseFloat(n.lineHeight),l=Math.max(parseFloat(e.rows)*s+u,parseFloat(v.getPropertyValue("--v-input-control-height"))),V=parseFloat(e.maxRows)*s+u||1/0,a=Me(f??0,l,V);y.value=Math.floor((a-u)/s),_.value=Be(a)})}be(k),A(d,k),A(()=>e.rows,k),A(()=>e.maxRows,k),A(()=>e.density,k);let g;return A(p,n=>{n?(g=new ResizeObserver(k),g.observe(p.value)):g==null||g.disconnect()}),ye(()=>{g==null||g.disconnect()}),we(()=>{const n=!!(m.counter||e.counter||e.counterValue),v=!!(n||m.details),[u,f]=he(P),{modelValue:s,...l}=ae.filterProps(e),V=Ce(e);return t(ae,K({ref:N,modelValue:d.value,"onUpdate:modelValue":a=>d.value=a,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":S.value},e.class],style:e.style},u,l,{centerAffix:y.value===1&&!S.value,focused:w.value}),{...m,default:a=>{let{id:o,isDisabled:I,isDirty:Q,isReadonly:se,isValid:re}=a;return t(ke,K({ref:x,style:{"--v-textarea-control-height":_.value},onClick:C,onMousedown:$,"onClick:clear":j,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},V,{id:o.value,active:F.value||Q.value,centerAffix:y.value===1&&!S.value,dirty:Q.value||e.dirty,disabled:I.value,focused:w.value,error:re.value===!1}),{...m,default:ue=>{let{props:{class:X,...ee}}=ue;return t(J,null,[e.prefix&&t("span",{class:"v-text-field__prefix"},[e.prefix]),te(t("textarea",K({ref:b,class:X,value:d.value,onInput:U,autofocus:e.autofocus,readonly:se.value,disabled:I.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:h,onBlur:H},ee,f),null),[[Pe("intersect"),{handler:R},null,{once:!0}]]),e.autoGrow&&te(t("textarea",{class:[X,"v-textarea__sizer"],id:`${ee.id}-sizer`,"onUpdate:modelValue":ie=>d.value=ie,ref:p,readonly:!0,"aria-hidden":"true"},null),[[_e,d.value]]),e.suffix&&t("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:v?a=>{var o;return t(J,null,[(o=m.details)==null?void 0:o.call(m,a),n&&t(J,null,[t("span",null,null),t(Se,{active:e.persistentCounter||w.value,value:O.value,max:L.value},m.counter)])])}:void 0})}),Fe({},N,x,b)}});const ua=e=>(Je("data-v-3f7a5b70"),e=e(),We(),e),ia=ua(()=>Ye("h1",{class:"text-center mt-4"},"商品管理",-1)),da={__name:"ProductsView",setup(e){const{apiAuth:B}=Te(),P=Ue(),M=c(null),m=c(!1),d=c(""),w=s=>{console.log('點擊"新增商品"'),s?(d.value=s._id,x.value.value=s.name,_.value.value=s.price,b.value.value=s.description,F.value.value=s.category,h.value.value=s.sell):d.value="",m.value=!0},z=()=>{m.value=!1,N(),M.value.deleteFileRecord()},H=["排球衣","排球褲","排球襪","排球鞋","球具","配件"],O=Ze({name:Z().required("缺少商品名稱"),price:Qe().typeError("商品價格格式錯誤").required("缺少商品價格").min(0,"商品價格不能小於 0"),description:Z().required("缺少商品說明"),category:Z().required("缺少商品分類").test("isCategory","商品分類錯誤",s=>H.includes(s)),sell:Xe()}),{handleSubmit:L,isSubmitting:R,resetForm:N}=ea({validationSchema:O,initialValues:{name:"",price:0,description:"",category:"",sell:!1}}),x=D("name"),_=D("price"),b=D("description"),F=D("category"),h=D("sell"),C=c([]),$=c([]),j=L(async s=>{var l,V,a;if(!((l=C.value[0])!=null&&l.error)&&!(d.value===""&&C.value.length===0))try{const o=new FormData;o.append("name",s.name),o.append("price",s.price),o.append("description",s.description),o.append("category",s.category),o.append("sell",s.sell),C.value.length>0&&o.append("image",C.value[0].file),d.value===""?await B.post("/products",o):await B.patch("/products/"+d.value,o),P({text:d.value===""?"新增成功":"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),z(),f()}catch(o){console.log(o);const I=((a=(V=o==null?void 0:o.response)==null?void 0:V.data)==null?void 0:a.message)||"發生錯誤，請稍後再試";P({text:I,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),U=c(10),p=c([{key:"createdAt",order:"desc"}]),y=c(1),S=c([]),k=[{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"名稱",align:"left",sortable:!0,key:"name"},{title:"價格",align:"center",sortable:!0,key:"price"},{title:"分類",align:"center",sortable:!0,key:"category"},{title:"上架",align:"center",sortable:!0,key:"sell"},{title:"編輯",align:"center",sortable:!1,key:"edit"}],g=c(!0),n=c(0),v=c(""),u=async()=>{var s,l,V,a;g.value=!0;try{const{data:o}=await B.get("/products/all",{params:{page:y.value,itemsPerPage:U.value,sortBy:((s=p.value[0])==null?void 0:s.key)||"createdAt",sortOrder:((l=p.value[0])==null?void 0:l.order)==="asc"?1:-1,search:v.value}});S.value.splice(0,S.value.length,...o.result.data),n.value=o.result.total}catch(o){console.log(o);const I=((a=(V=o==null?void 0:o.response)==null?void 0:V.data)==null?void 0:a.message)||"發生錯誤，請稍後再試";P({text:I,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}g.value=!1};u();const f=()=>{y.value=1,u()};return(s,l)=>{const V=Ae("vue-file-agent");return le(),oe(ta,null,{default:r(()=>[t(ne,{class:"row"},{default:r(()=>[t(q,{cols:"12"},{default:r(()=>[ia]),_:1}),t(q,{cols:"12"},{default:r(()=>[t(la,{"items-per-page":U.value,"onUpdate:itemsPerPage":[l[2]||(l[2]=a=>U.value=a),u],"sort-by":p.value,"onUpdate:sortBy":[l[3]||(l[3]=a=>p.value=a),u],page:y.value,"onUpdate:page":[l[4]||(l[4]=a=>y.value=a),u],items:S.value,headers:k,loading:g.value,"items-length":n.value,search:v.value,hover:""},{top:r(()=>[t(ne,null,{default:r(()=>[t(q,{cols:"3",xl:"2",md:"2",sm:"4"},{default:r(()=>[t(E,{"prepend-icon":"mdi-plus",color:"#1565C0",height:"40",rounded:"xl",block:"",class:"mt-3",onClick:l[0]||(l[0]=a=>w())},{default:r(()=>[T("新增商品")]),_:1})]),_:1}),t(q,{cols:"9",xl:"10",md:"10",sm:"8"},{default:r(()=>[t(Y,{label:"搜尋","append-icon":"mdi-magnify",modelValue:v.value,"onUpdate:modelValue":l[1]||(l[1]=a=>v.value=a),variant:"underlined","onClick:append":f,onKeydown:De(f,["enter"])},null,8,["modelValue"])]),_:1})]),_:1})]),"item.image":r(({item:a})=>[t(ze,{src:a.image,height:"60px"},null,8,["src"])]),"item.sell":r(({item:a})=>[a.sell?(le(),oe(He,{key:0},{default:r(()=>[T("mdi-check")]),_:1})):Ne("",!0)]),"item.edit":r(({item:a})=>[t(E,{icon:"mdi-pencil",variant:"text",color:"#1565C0",onClick:o=>w(a)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1}),t(Ke,{modelValue:m.value,"onUpdate:modelValue":l[12]||(l[12]=a=>m.value=a),persistent:"",width:"600px"},{default:r(()=>[t(aa,{disabled:i(R),onSubmit:$e(i(j),["prevent"])},{default:r(()=>[t(Ge,null,{default:r(()=>[t(Ee,null,{default:r(()=>[T(qe(d.value===""?"新增商品":"編輯商品"),1)]),_:1}),t(Oe,null,{default:r(()=>[t(Y,{label:"名稱",modelValue:i(x).value.value,"onUpdate:modelValue":l[5]||(l[5]=a=>i(x).value.value=a),"error-messages":i(x).errorMessage.value},null,8,["modelValue","error-messages"]),t(Y,{label:"價格",type:"number",min:"0",modelValue:i(_).value.value,"onUpdate:modelValue":l[6]||(l[6]=a=>i(_).value.value=a),"error-messages":i(_).errorMessage.value},null,8,["modelValue","error-messages"]),t(na,{label:"分類",items:H,modelValue:i(F).value.value,"onUpdate:modelValue":l[7]||(l[7]=a=>i(F).value.value=a),"error-messages":i(F).errorMessage.value},null,8,["modelValue","error-messages"]),t(oa,{label:"上架",modelValue:i(h).value.value,"onUpdate:modelValue":l[8]||(l[8]=a=>i(h).value.value=a),"error-messages":i(h).errorMessage.value},null,8,["modelValue","error-messages"]),t(ra,{label:"說明",modelValue:i(b).value.value,"onUpdate:modelValue":l[9]||(l[9]=a=>i(b).value.value=a),"error-messages":i(b).errorMessage.value},null,8,["modelValue","error-messages"]),t(V,{modelValue:C.value,"onUpdate:modelValue":l[10]||(l[10]=a=>C.value=a),rawModelValue:$.value,"onUpdate:rawModelValue":l[11]||(l[11]=a=>$.value=a),accept:"image/jpeg,image/png",deletable:"","error-text":{type:"檔案格式不支援",size:"檔案超過 1MB 大小限制"},"help-text":"選擇檔案或拖曳到這裡","max-files":1,"max-size":"1MB",ref_key:"fileAgent",ref:M},null,8,["modelValue","rawModelValue"])]),_:1}),t(Le,null,{default:r(()=>[t(je),t(E,{color:"red",disabled:i(R),onClick:z},{default:r(()=>[T("取消")]),_:1},8,["disabled"]),t(E,{color:"green",type:"submit",loading:i(R)},{default:r(()=>[T("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])]),_:1})}}},Ca=Re(da,[["__scopeId","data-v-3f7a5b70"]]);export{Ca as default};
