import{an as A,ae as N,ao as R,ad as W,x as y,o as b,A as $,af as x,aq as g,al as p,c as a,ah as n,as as z,a6 as D,am as T,ay as C,ax as j,J as d,ak as w,az as E,aA as F}from"./index-df8755fd.js";import{V as J}from"./VContainer-a230f4f3.js";import{V as L}from"./VRow-b1b13eff.js";import{V as v}from"./VCol-91edcb38.js";import{V as M}from"./VDataTable-7b5c889a.js";import"./VList-647416b4.js";import"./VDivider-66ea9690.js";import"./VChip-4965432d.js";import"./VSlideGroup-d168fa5a.js";const V=u=>(E("data-v-0706d266"),u=u(),F(),u),U=V(()=>p("div",{class:"top-block"},null,-1)),G={style:{border:"2px solid rgb(4, 0, 255)"}},H=V(()=>p("h1",{class:"text-center mt-15 mb-5",style:{color:"rgb(26, 108, 163)"}},"確認預約",-1)),K={key:0},O={class:"number-box"},Q={__name:"CheckView",setup(u){const{apiAuth:m}=T(),r=N(),_=R(),k=W(),i=y([]),B=[{title:"場地",key:"appointment.court"},{title:"日期",key:"appointment.date"},{title:"開始時間",key:"appointment.begin"},{title:"結束時間",key:"appointment.end"},{title:"人數",key:"quantity"},{title:"操作",key:"action"}];b(()=>i.value.reduce((e,o)=>e+o.quantity*o.appointment.price,0));const S=b(()=>i.value.length>0&&!i.value.some(e=>!e.appointment.sell)),h=async(e,o)=>{var t,s;if(!_.isLogin){k.push("/login");return}try{const{data:c}=await m.patch("/users/reservation",{appointment:e,quantity:o});_.reservation=c.result,r({text:"修改成功",showCloseButton:!1,snackbarProps:{timeout:1e3,color:"green",location:"bottom"}});const l=i.value.findIndex(P=>P.appointment._id===e);i.value[l].quantity+=o,i.value[l].quantity<=0&&i.value.splice(l,1)}catch(c){const l=((s=(t=c==null?void 0:c.response)==null?void 0:t.data)==null?void 0:s.message)||"發生錯誤，請稍後再試";r({text:l,showCloseButton:!1,snackbarProps:{timeout:1500,color:"red",location:"bottom"}})}},f=y(!1),q=async()=>{var e,o;f.value=!0;try{await m.post("/orders"),_.cart=0,k.push("/orders"),r({text:"結帳成功",showCloseButton:!1,snackbarProps:{timeout:1500,color:"green",location:"bottom"}})}catch(t){const s=((o=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:o.message)||"發生錯誤，請稍後再試";r({text:s,showCloseButton:!1,snackbarProps:{timeout:1500,color:"red",location:"bottom"}})}f.value=!1};$(async()=>{var e,o;try{const{data:t}=await m.get("/users/cart");cart.value.push(...t.result)}catch(t){const s=((o=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:o.message)||"發生錯誤，請稍後再試";r({text:s,showCloseButton:!1,snackbarProps:{timeout:1500,color:"red",location:"bottom"}})}});const I=()=>{const e=window.innerWidth;return e>=1200?"70%":e>=960?"80%":e>=600?"85%":"90%"};return(e,o)=>(x(),g(D,null,[U,p("div",G,[a(J,{class:"h-100 d-flex justify-center align-center",style:z([{width:I()},{border:"2px solid #bc3636"}])},{default:n(()=>[a(L,{class:"row"},{default:n(()=>[a(v,{cols:"12"},{default:n(()=>[H]),_:1}),a(v,{cols:"12"},{default:n(()=>[a(M,{items:i.value,headers:B},{"item.appointment.name":n(({item:t})=>[t.appointment.sell?(x(),g("span",K,C(t.appointment.name),1)):j("",!0)]),"item.quantity":n(({item:t})=>[p("div",O,[a(d,{variant:"text",icon:"mdi-minus",color:"red",onClick:s=>h(t.appointment._id,-1)},null,8,["onClick"]),w(" "+C(t.quantity)+" ",1),a(d,{variant:"text",icon:"mdi-plus",color:"green",onClick:s=>h(t.appointment._id,1)},null,8,["onClick"])])]),"item.action":n(({item:t})=>[a(d,{variant:"text",icon:"mdi-delete",color:"rgb(26, 108, 163)",onClick:s=>h(t.appointment._id,t.quantity*-1)},null,8,["onClick"])]),_:1},8,["items"])]),_:1}),a(v,{class:"text-center",cols:"12"},{default:n(()=>[a(d,{color:"green",class:"mb-4",disabled:!S.value,loading:f.value,onClick:q},{default:n(()=>[w(" 結帳")]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["style"])])],64))}},it=A(Q,[["__scopeId","data-v-0706d266"]]);export{it as default};
