import{_ as ee,X as ae,x as u,a0 as W,a9 as X,a2 as o,ai as le,c as a,J as I,aa as c,aX as v,b5 as te,af as j,W as oe,ae as se,a8 as s,aW as re,ac as ne,aj as ue,ad as ie,aR as de,aI as me,ab as pe,ag as ce,ah as ge,a6 as ve}from"./index-fc950cf0.js";import{c as be,b,e as fe,a as Ve,f as ye,h as he}from"./index.esm-195823e1.js";import{u as ke,a as i,V as _e}from"./vee-validate.esm-ca539efa.js";import{V as we}from"./VContainer-2bf56397.js";import{V as r}from"./VCol-eebdc897.js";import{V as xe,a as T,b as Ce}from"./VDataTableServer-0dec3b0f.js";import{V as L}from"./VRow-e02eb952.js";import"./VList-7c94dd58.js";import"./ssrBoot-8ea62140.js";import"./VDivider-1e8d71a5.js";import"./VChip-f39d3fa1.js";import"./VSlideGroup-bc2fc257.js";const Se=f=>(ce("data-v-667cc64b"),f=f(),ge(),f),Ue=Se(()=>ve("h1",{class:"text-center mt-4"},"開放時段管理",-1)),Ae={__name:"AppointmentsView",setup(f){const{apiAuth:P}=le(),B=ae(),E=["新手友善","男女混打","僅限女生","僅限男生","宵夜場","早場","一般場","高手場","未開放","只開放季打","徵臨打"],V=u(!1),m=u(""),N=t=>{t?(m.value=t._id,y.value.value=t.court,p.value.value=t.date,h.value.value=t.begin,k.value.value=t.end,_.value.value=t.peoplenumber,w.value.value=t.info,x.value.value=t.height,C.value.value=t.online):m.value="",V.value=!0},H=()=>{V.value=!1,G()},K=["女網","男網"],J=["A","未開放"],O=be({court:b().required("場地，必填"),date:fe().required("缺少日期"),begin:b().required("缺少開始時間"),end:b().required("缺少結束時間"),peoplenumber:Ve().typeError("開放名額格式錯誤").required("缺少開放名額").min(0,"開放名額不能小於0"),info:ye().of(b().required("此欄位為必填")).required("此欄位為必填"),height:b().required("缺少網高").test("isHeight","網高分類錯誤",t=>K.includes(t)),online:he()}),{handleSubmit:z,isSubmitting:M,resetForm:G}=ke({validationSchema:O,initialValues:{court:"A",date:new Date,begin:"12:00",end:"12:00",peoplenumber:15,height:"",online:!0}}),y=i("court"),p=i("date"),h=i("begin"),k=i("end"),_=i("peoplenumber"),w=i("info"),x=i("height"),C=i("online"),Q=z(async t=>{var l,e;try{m.value===""?await P.post("/appointments",{court:t.court,date:p.value.value,begin:t.begin,end:t.end,peoplenumber:t.peoplenumber,info:t.info,height:t.height,online:t.online}):await P.patch("/appointments/"+m.value,{court:t.court,date:p.value.value,begin:t.begin,end:t.end,peoplenumber:t.peoplenumber,info:t.info,height:t.height,online:t.online}),B({text:m.value===""?"新增成功":"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),H(),F()}catch(d){console.log("更新表格回到第一頁錯誤");const n=((e=(l=d==null?void 0:d.response)==null?void 0:l.data)==null?void 0:e.message)||"發生錯誤，請稍後再試";B({text:n,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),q=u(10),S=u([{key:"createdAt",order:"desc"}]),U=u(1),D=u([]),Y=[{title:"日期",align:"center",sortable:!0,key:"date"},{title:"開始",align:"center",sortable:!0,key:"begin"},{title:"結束",align:"center",sortable:!0,key:"end"},{title:"名額",align:"center",sortable:!0,key:"peoplenumber"},{title:"網高",align:"center",sortable:!0,key:"height"},{title:"上線",align:"center",sortable:!0,key:"online"},{title:"場地",align:"center",sortable:!1,key:"court"},{title:"編輯",align:"center",sortable:!1,key:"edit"}],$=u(!0),R=u(0),A=u(""),g=async()=>{var t,l,e,d;$.value=!0;try{const{data:n}=await P.get("/appointments/all",{params:{page:U.value,itemsPerPage:q.value,sortBy:((t=S.value[0])==null?void 0:t.key)||"createdAt",sortOrder:((l=S.value[0])==null?void 0:l.order)==="asc"?1:-1,search:A.value}});D.value.splice(0,D.value.length,...n.result.data),R.value=n.result.total}catch(n){console.log(n);const Z=((d=(e=n==null?void 0:n.response)==null?void 0:e.data)==null?void 0:d.message)||"發生錯誤，請稍後再試";B({text:Z,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}$.value=!1};g();const F=()=>{U.value=1,g()};return(t,l)=>(W(),X(we,null,{default:o(()=>[a(L,{class:"row"},{default:o(()=>[a(r,{cols:"12"},{default:o(()=>[Ue]),_:1}),a(r,{cols:"12"},{default:o(()=>[a(xe,{"items-per-page":q.value,"onUpdate:itemsPerPage":[l[2]||(l[2]=e=>q.value=e),g],"sort-by":S.value,"onUpdate:sortBy":[l[3]||(l[3]=e=>S.value=e),g],page:U.value,"onUpdate:page":[l[4]||(l[4]=e=>U.value=e),g],items:D.value,headers:Y,loading:$.value,"items-length":R.value,search:A.value,hover:""},{top:o(()=>[a(L,null,{default:o(()=>[a(r,{cols:"12",xl:"3",md:"3",sm:"7"},{default:o(()=>[a(I,{"prepend-icon":"mdi-plus",color:"#1565C0",height:"40",rounded:"xl",block:"",class:"mt-3",onClick:l[0]||(l[0]=e=>N())},{default:o(()=>[c("新增時段")]),_:1})]),_:1}),a(r,{cols:"12",xl:"9",md:"9",sm:"5"},{default:o(()=>[a(v,{label:"搜尋","append-icon":"mdi-magnify",modelValue:A.value,"onUpdate:modelValue":l[1]||(l[1]=e=>A.value=e),variant:"underlined","onClick:append":F,onKeydown:te(F,["enter"])},null,8,["modelValue"])]),_:1})]),_:1})]),"item.date":o(({item:e})=>[c(j(new Date(e.date).toLocaleDateString()),1)]),"item.online":o(({item:e})=>[e.online?(W(),X(oe,{key:0},{default:o(()=>[c("mdi-check")]),_:1})):se("",!0)]),"item.edit":o(({item:e})=>[a(I,{icon:"mdi-pencil",variant:"text",color:"#1565C0",onClick:d=>N(e)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1}),a(pe,{modelValue:V.value,"onUpdate:modelValue":l[13]||(l[13]=e=>V.value=e),persistent:"",width:"600px"},{default:o(()=>[a(_e,{disabled:s(M),onSubmit:re(s(Q),["prevent"])},{default:o(()=>[a(ne,null,{default:o(()=>[a(ue,null,{default:o(()=>[c(j(m.value===""?"新增時段場次":"編輯時段場次"),1)]),_:1}),a(ie,null,{default:o(()=>[a(L,null,{default:o(()=>[a(r,{cols:"12"},{default:o(()=>[a(T,{label:"場地",items:J,modelValue:s(y).value.value,"onUpdate:modelValue":l[5]||(l[5]=e=>s(y).value.value=e),"error-messages":s(y).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),a(r,{cols:"12",sm:"12"},{default:o(()=>[a(v,{label:"日期",type:"date",modelValue:s(p).value.value,"onUpdate:modelValue":l[6]||(l[6]=e=>s(p).value.value=e),"error-messages":s(p).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),a(r,{cols:"12",sm:"6"},{default:o(()=>[a(v,{label:"開始時間",type:"time",modelValue:s(h).value.value,"onUpdate:modelValue":l[7]||(l[7]=e=>s(h).value.value=e),"error-messages":s(h).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),a(r,{cols:"12",sm:"6"},{default:o(()=>[a(v,{label:"結束時間",type:"time",modelValue:s(k).value.value,"onUpdate:modelValue":l[8]||(l[8]=e=>s(k).value.value=e),"error-messages":s(k).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),a(r,{cols:"12",sm:"6"},{default:o(()=>[a(v,{label:"開放名額",type:"number",min:"0",modelValue:s(_).value.value,"onUpdate:modelValue":l[9]||(l[9]=e=>s(_).value.value=e),"error-messages":s(_).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),a(r,{cols:"12",sm:"6"},{default:o(()=>[a(T,{label:"網高",items:K,modelValue:s(x).value.value,"onUpdate:modelValue":l[10]||(l[10]=e=>s(x).value.value=e),"error-messages":s(x).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),a(r,{cols:"12"},{default:o(()=>[a(T,{label:"說明",items:E,modelValue:s(w).value.value,"onUpdate:modelValue":l[11]||(l[11]=e=>s(w).value.value=e),multiple:"",chips:"","error-messages":s(w).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),a(Ce,{label:"上線",modelValue:s(C).value.value,"onUpdate:modelValue":l[12]||(l[12]=e=>s(C).value.value=e),"error-messages":s(C).errorMessage.value,class:"ml-2"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),a(de,null,{default:o(()=>[a(me),a(I,{color:"red",disabled:s(M),onClick:H},{default:o(()=>[c("取消")]),_:1},8,["disabled"]),a(I,{color:"green",type:"submit",loading:s(M)},{default:o(()=>[c("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])]),_:1}))}},Ke=ee(Ae,[["__scopeId","data-v-667cc64b"]]);export{Ke as default};
